const questionBank = {
    "jss": {
        "Language Arts": {
            "2019": [{
                    "question": "One of the bulls………from the herd.",
                    "options": ["have been strayed", "has been strayed", "have strayed", "has strayed"],
                    "correctAnswer": "has strayed"
                },

                {
                    "question": "I saw the dog………….out of the house.",
                    "options": ["run", "is running", "ran", "was running"],
                    "correctAnswer": "run"
                },

                {
                    "question": "Habib goes to school……train.",
                    "options": ["by", "on", "with", "in"],
                    "correctAnswer": "by"
                },
                {
                    "question": "This phone is not mine; it is ...",
                    "options": ["mine uncle’s", "my uncle’s", "my uncles", "mine uncle"],
                    "correctAnswer": "my uncle’s"
                },
                {
                    "question": "I wish I ….. my friend next week.",
                    "options": ["can visit", "am visiting", "shall visit", "could visit"],
                    "correctAnswer": "could visit"
                },
                {
                    "question": "Aba took ….. her mother in many ways.",
                    "options": ["after", "up", "on", "by"],
                    "correctAnswer": "after"
                },
                {
                    "question": "That girl is allergic ….. dust.",
                    "options": ["with", "to", "against", "about"],
                    "correctAnswer": "to"
                },
                {
                    "question": "My brother, with his children, ….. travelling to Salaga next week.",
                    "options": ["is", "are", "was", "were"],
                    "correctAnswer": "is"
                },
                {
                    "question": "It is high time we …… for the meeting.",
                    "options": ["left", "leave", "have to leave", "will leave"],
                    "correctAnswer": "left"
                },
                {
                    "question": "The accused person refused to appear before the ….. panel.",
                    "options": ["five-man’s", "five-man", "five-men", "five-mens"],
                    "correctAnswer": "five-man"
                },
                {
                    "question": "The stories her children told her made her ……",
                    "options": ["to laugh", "laughing", "laughed", "laugh"],
                    "correctAnswer": "laugh"
                },
                {
                    "question": "They have not bought …… of the two prescribed books.",
                    "options": ["neither", "either", "none", "all"],
                    "correctAnswer": "either"
                },
                {
                    "question": "The boy found the assignment …… to do",
                    "options": ["much too difficult", "difficult too much", "too much difficult", "much difficult too"],
                    "correctAnswer": "much too difficult"
                },
                {
                    "question": "The oxen lay on the bare floor, …..?",
                    "options": ["didn’t they", "don’t they", "didn’t it", "isn’t it"],
                    "correctAnswer": "didn’t they"
                }

            ]
        },
        "Mathematics": {
            "2019": [{
                    "question": "What is the value of π (pi) to two decimal places?",
                    "options": ["3.12", "3.14", "3.15", "3.16"],
                    "correctAnswer": "3.14"
                },
                {
                    "question": "What is 12 x 8?",
                    "options": ["96", "98", "100", "102"],
                    "correctAnswer": "96"
                },
                {
                    "question": "If a triangle has two equal sides, what type of triangle is it?",
                    "options": ["Equilateral", "Isosceles", "Scalene", "Right"],
                    "correctAnswer": "Isosceles"
                },
                {
                    "question": "What is the square root of 81?",
                    "options": ["7", "8", "9", "10"],
                    "correctAnswer": "9"
                },
                {
                    "question": "What is the sum of angles in a triangle?",
                    "options": ["90 degrees", "180 degrees", "360 degrees", "270 degrees"],
                    "correctAnswer": "180 degrees"
                }
            ]
        },
        "Integrated Science": {
            "2019": [{
                    "question": "What is the process by which plants make their own food using sunlight?",
                    "options": ["Photosynthesis", "Respiration", "Digestion", "Fermentation"],
                    "correctAnswer": "Photosynthesis"
                },
                {
                    "question": "Which of the following is a renewable source of energy?",
                    "options": ["Coal", "Natural Gas", "Solar Power", "Oil"],
                    "correctAnswer": "Solar Power"
                },
                {
                    "question": "What is the boiling point of water at sea level?",
                    "options": ["50°C", "100°C", "150°C", "200°C"],
                    "correctAnswer": "100°C"
                },
                {
                    "question": "Which gas is essential for humans to breathe?",
                    "options": ["Carbon Dioxide", "Oxygen", "Nitrogen", "Helium"],
                    "correctAnswer": "Oxygen"
                },
                {
                    "question": "Which part of the plant is primarily responsible for photosynthesis?",
                    "options": ["Root", "Stem", "Leaf", "Flower"],
                    "correctAnswer": "Leaf"
                },
            ]

        },
        "Social Studies": {
            "2019": [{
                    "question": "Which of the following is a primary function of the family?",
                    "options": ["To educate children", "To provide national defense", "To build roads", "To govern the country"],
                    "correctAnswer": "To educate children"
                },
                {
                    "question": "What is the capital city of Ghana?",
                    "options": ["Kumasi", "Accra", "Tamale", "Takoradi"],
                    "correctAnswer": "Accra"
                },
                {
                    "question": "Which of the following is considered a civic responsibility?",
                    "options": ["Paying taxes", "Watching television", "Playing sports", "Eating breakfast"],
                    "correctAnswer": "Paying taxes"
                },
                {
                    "question": "Which organ of government is responsible for making laws?",
                    "options": ["Executive", "Judiciary", "Parliament", "Police"],
                    "correctAnswer": "Parliament"
                },
                {
                    "question": "What is the significance of Independence Day in many countries?",
                    "options": ["It marks the day a new government is elected", "It celebrates the country's freedom from colonial rule", "It is the start of the new school year", "It is a day to honor sports heroes"],
                    "correctAnswer": "It celebrates the country's freedom from colonial rule"
                }
            ]
        }
    },
    "sss": {
        "Maths": {
            "2019": [{
                    "question": "What is the solution to the equation 2x - 3 = 7?",
                    "options": ["x = 2", "x = 5", "x = -2", "x = -5"],
                    "correctAnswer": "x = 5"
                },
                {
                    "question": "If a triangle has sides of length 5 cm, 12 cm, and 13 cm, what type of triangle is it?",
                    "options": ["Equilateral", "Isosceles", "Right-angled", "Scalene"],
                    "correctAnswer": "Right-angled"
                },
                {
                    "question": "What is the value of the expression 3^2 + 4^2?",
                    "options": ["12", "18", "25", "30"],
                    "correctAnswer": "25"
                },
                {
                    "question": "A circle has a radius of 7 cm. What is its circumference? (Use π = 22/7)",
                    "options": ["14 cm", "22 cm", "44 cm", "28 cm"],
                    "correctAnswer": "44 cm"
                },
                {
                    "question": "Solve for y: 3y + 4 = 19",
                    "options": ["y = 3", "y = 5", "y = 7", "y = 15"],
                    "correctAnswer": "y = 5"
                }
            ]
        },
        "English": {
            "2019": [{
                    "question": "Which of the following sentences is grammatically correct?",
                    "options": [
                        "Neither of the boys are going to the party.",
                        "Neither of the boys is going to the party.",
                        "Neither of the boy are going to the party.",
                        "Neither of the boy is going to the party."
                    ],
                    "correctAnswer": "Neither of the boys is going to the party."
                },
                {
                    "question": "Choose the correct form of the verb: She _____ to the gym every morning.",
                    "options": [
                        "go",
                        "gone",
                        "going",
                        "goes"
                    ],
                    "correctAnswer": "goes"
                },
                {
                    "question": "Which sentence uses the passive voice?",
                    "options": [
                        "The chef cooked a delicious meal.",
                        "The meal was cooked by the chef.",
                        "The chef is cooking a meal.",
                        "The chef will cook a meal."
                    ],
                    "correctAnswer": "The meal was cooked by the chef."
                },
                {
                    "question": "Identify the adjective in this sentence: 'The beautiful flowers bloom in spring.'",
                    "options": [
                        "flowers",
                        "bloom",
                        "beautiful",
                        "spring"
                    ],
                    "correctAnswer": "beautiful"
                },
                {
                    "question": "Select the word that best completes the sentence: 'If I _____ you, I would study harder.'",
                    "options": [
                        "was",
                        "were",
                        "am",
                        "be"
                    ],
                    "correctAnswer": "were"
                }
            ]
        },
        "History": {
            "2019": [{
                    "question": "Who was the first President of Ghana after its independence from Britain?",
                    "options": [
                        "Kwame Nkrumah",
                        "J.B. Danquah",
                        "Kofi Busia",
                        "Flt. Lt. Jerry John Rawlings"
                    ],
                    "correctAnswer": "Kwame Nkrumah"
                },
                {
                    "question": "Which war was fought between 1914 and 1918 and is often referred to as the 'Great War'?",
                    "options": [
                        "World War I",
                        "World War II",
                        "The Korean War",
                        "The Vietnam War"
                    ],
                    "correctAnswer": "World War I"
                },
                {
                    "question": "What was the main cause of the American Civil War?",
                    "options": [
                        "Taxation without representation",
                        "Slavery",
                        "Expansion of the frontier",
                        "The Boston Tea Party"
                    ],
                    "correctAnswer": "Slavery"
                },
                {
                    "question": "Which ancient civilization is known for its development of the first writing system called cuneiform?",
                    "options": [
                        "The Egyptians",
                        "The Greeks",
                        "The Sumerians",
                        "The Romans"
                    ],
                    "correctAnswer": "The Sumerians"
                },
                {
                    "question": "In which year did the Berlin Wall fall, marking the beginning of the end of the Cold War?",
                    "options": [
                        "1987",
                        "1988",
                        "1989",
                        "1990"
                    ],
                    "correctAnswer": "1989"
                }
            ]
        },
        "Government": {
            "2019": [{
                    "question": "Which branch of government is responsible for enforcing laws?",
                    "options": [
                        "Legislative",
                        "Judicial",
                        "Executive",
                        "Administrative"
                    ],
                    "correctAnswer": "Executive"
                },
                {
                    "question": "What is the primary function of the legislature in a democratic government?",
                    "options": [
                        "Enforce laws",
                        "Interpret laws",
                        "Create laws",
                        "Execute laws"
                    ],
                    "correctAnswer": "Create laws"
                },
                {
                    "question": "Which document outlines the fundamental principles and structures of a government?",
                    "options": [
                        "Constitution",
                        "Bill of Rights",
                        "Statute",
                        "Executive Order"
                    ],
                    "correctAnswer": "Constitution"
                },
                {
                    "question": "In a federal system of government, which level of government typically handles education policy?",
                    "options": [
                        "Federal",
                        "State",
                        "Local",
                        "National"
                    ],
                    "correctAnswer": "State"
                },
                {
                    "question": "Who is the head of state in a parliamentary democracy?",
                    "options": [
                        "Prime Minister",
                        "President",
                        "King/Queen",
                        "Chancellor"
                    ],
                    "correctAnswer": "Prime Minister"
                }
            ]
        }
    }

};

// Global variables
/*let usernameInput;*/
let leaderboardData = []; // store leaderboard entries
let questions = [];
let currentQuestionIndex = 0;
let timeInterval;
let userAnswers = []; //string to store user's answers for review
let timeLeft = 60;
let isPaused = false;
let selectedLevel = '';
/*let selectedSubject = '';
let selectedYear = '';*/
let scoreBoard = {
    correct: 0,
    wrong: 0,
    unanswered: 0,
    remaining: 60
};

const savedLeaderboardData = localStorage.getItem('leaderboardData');
if (savedLeaderboardData) {
    leaderboardData = JSON.parse(savedLeaderboardData);
}


// Add event listeners for the different buttons and inputs
document.addEventListener('DOMContentLoaded', () => {
    const startGame = document.getElementById('start-game');
    const usernameInput = document.getElementById('username-input');
    /*const usernameContainer = document.getElementById('username-container');*/
    const leaderboardButton = document.getElementById('leaderboard-btn');
    const leaderboardSection = document.getElementById('leaderboard-section');
    const clearLeaderboard = document.getElementById('clear-leaderboard');
    const backToLevelSelection = document.getElementById('back-to-level-selection');
    const aboutTheGame = document.getElementById('about-the-game');
    const closeAboutGame = document.getElementById('close-about-game');
    const instructions = document.getElementById('instructions');
    const backToAboutGame = document.getElementById('back-to-about-game');
    const rules = document.getElementById('rules');
    const backToAboutRules = document.getElementById('back-to-about-rules');
    const backToHomePage = document.getElementById('back-to-home-page');
    const levelSelection = document.getElementById('level-selection');
    const jssLevel = document.getElementById('jss-level');
    const sssLevel = document.getElementById('sss-level');
    const subjectButtons = document.querySelectorAll('.subject-btn');
    const backToSubjects = document.getElementById('back-to-subjects');
    /*const selectedSubjectText = document.getElementById('selected-subject');*/
    const startTest = document.getElementById('start-test');
    const subjectSelectionJss = document.getElementById('subject-selection-jss');
    const subjectSelectionSss = document.getElementById('subject-selection-sss');
    const backJss = document.getElementById('back-jss');
    const backSss = document.getElementById('back-sss');
    const yearSelection = document.getElementById('year-selection');
    const yearDropdown = document.getElementById('year-dropdown');
    const testSection = document.getElementById('test-section');
    const questionContainer = document.getElementById('question-container');
    const optionsContainer = document.getElementById('options-container');
    const timerBar = document.getElementById('timer-bar');
    /*const results = document.getElementById('results'); */
    const nextQuestion = document.getElementById('next-question');
    const pause = document.getElementById('pause');
    const resume = document.getElementById('resume');
    const reviewSection = document.getElementById('review-section');
    



    // To navigate to test page

    if (startGame) {
        startGame.addEventListener('click', () => {
            window.location.href = 'game.html';
        });
    }

    // Username input with event listener for real-time storage of username
    if (usernameInput) {
        usernameInput.addEventListener('input', (e) => {
            const username = e.target.value.trim();
            // Save trimmed username to localStorage
            if (username !== '') {
                localStorage.setItem('username', username);
            }
        });
    }

    // Display leaderboard

    if (leaderboardButton) {
        leaderboardButton.addEventListener('click', () => {
            levelSelection.style.display = 'none';
            leaderboardSection.style.display = 'flex';
            updateLeaderboardSection();
        });
    }

    if (backToLevelSelection) {
        backToLevelSelection.addEventListener('click', () => {
            leaderboardSection.style.display = 'none';
            levelSelection.style.display = 'flex';
        });
    }

    // Clear leaderboard
    if (clearLeaderboard) {
        clearLeaderboard.addEventListener('click', () => {
            leaderboardData = [];
            localStorage.removeItem('leaderboardData');
            updateLeaderboardSection();
        });
    }

    // Display popup window for "About Game"
    if (aboutTheGame) {
        aboutTheGame.addEventListener('click', () => {
            document.getElementById('about-popup').style.display = 'flex';
        });
    }

    // Close popup window for "About Game"
    if (closeAboutGame) {
        closeAboutGame.addEventListener('click', () => {
            document.getElementById('about-popup').style.display = 'none';
        });
    }

    // Call popup window for "Instructions"
    if (instructions) {
        instructions.addEventListener('click', () => {
            document.getElementById('instructions-popup').style.display = 'flex';
        });
    }

    // Close popup window for "Instructions"
    if (backToAboutGame) {
        backToAboutGame.addEventListener('click', () => {
            document.getElementById('instructions-popup').style.display = 'none';
            document.getElementById('about-popup').style.display = 'flex';
        });
    }

    // Call popup window for "Game Rules"
    if (rules) {
        rules.addEventListener('click', () => {
            document.getElementById('game-rules-popup').style.display = 'flex';
        });
    }

    // Close popup window for "Game Rules"
    if (backToAboutRules) {
        backToAboutRules.addEventListener('click', () => {
            document.getElementById('game-rules-popup').style.display = 'none';
            document.getElementById('about-popup').style.display = 'flex';
        });
    }

    // Return to home page from test area
    if (backToHomePage) {
        backToHomePage.addEventListener('click', () => {
            window.location.href = 'index.html';
        });
    }


    // JSS Level Selection
    if (jssLevel) {
        jssLevel.addEventListener('click', () => {
            if (validateUsername()) {
                selectedLevel = 'jss';
                localStorage.setItem('selectedLevel', selectedLevel); /*New*/
                levelSelection.style.display = 'none';
                document.getElementById('subject-selection-jss').style.display = 'flex';
            }

        });
    }

    //SSS Level Selection
    if (sssLevel) {
        sssLevel.addEventListener('click', () => {
            if (validateUsername()) {
                selectedLevel = 'sss';
                localStorage.setItem('selectedLevel', selectedLevel); /* New */
                levelSelection.style.display = 'none';
                document.getElementById('subject-selection-sss').style.display = 'flex';
            }
        });
    }

    //Back to Level Selection from JSS
    if (backJss) {
        backJss.addEventListener('click', () => {
            subjectSelectionJss.style.display = 'none';
            levelSelection.style.display = 'flex';
        });
    }

    // Back to Level Selection from SSS
    if (backSss) {
        backSss.addEventListener('click', () => {
            subjectSelectionSss.style.display = 'none';
            levelSelection.style.display = 'flex';
        });
    }

    // Validate username to retrive trimmed username value from input field
    function validateUsername() {
        // Get trimmed value directly from input field
        const usernameInputValue = document.getElementById('username-input').value.trim();
        // Check if trimmed username is empty
        if (usernameInputValue === '') {
            alert('Please enter username to proceed');
            return false;
        }
        // Save the valid username to localStorage    
        localStorage.setItem('username', usernameInputValue);
        return true;
    } 


    // Select subject
    // Iterate over each button in the subject button array
    subjectButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            const selectedSubject = event.target.closest('.subject-btn').dataset.subject;
            localStorage.setItem('selectedSubject', selectedSubject);

            console.log(`Set Subject to localStorage: ${selectedSubject}`);
            console.log(`Stored in localStorage: ${localStorage.getItem('selectedSubject')}`);

            subjectSelectionJss.style.display = 'none';
            subjectSelectionSss.style.display = 'none';
            yearSelection.style.display = 'flex';

            

        });
    });
    console.log(`Retrieved Subject from localStorage: ${localStorage.getItem('selectedSubject')}`);

    // Back to subject selection from year selection

    if (backToSubjects) {
        backToSubjects.addEventListener('click', () => {
            yearSelection.style.display = 'none';
            if (localStorage.getItem('selectedLevel') === 'sss') /*(subjectSelectionJss.style.display === 'none')*/ {
                subjectSelectionSss.style.display = 'flex';
            } else {
                subjectSelectionJss.style.display = 'flex';
            }
        });
    }

    //Year selection dropdown
    if (yearDropdown) {
        yearDropdown.addEventListener('change', () => {
            const selectedYear = yearDropdown.value;
            // store selected year to localStorage under the key 'selectedYear'
            localStorage.setItem('selectedYear', selectedYear);
        });
    }


    // Start test latest update
    if (startTest) {
        startTest.addEventListener('click', () => {
            if (yearDropdown && yearDropdown.value.trim() !== "") {
                if (validateUsername()) {
                    const level = localStorage.getItem('selectedLevel');
                    const subject = localStorage.getItem('selectedSubject');
                    const year = yearDropdown.value;

                    console.log(`Selected Level: ${level}`);
                    console.log(`Selected Subject: ${subject}`);
                    console.log(`Selected Year: ${year}`);

                    if (level && subject && year) {
                        questions = questionBank[level][subject][year];

                        if (questions && questions.length > 0) {
                            scoreBoard.remaining = questions.length;
                            userAnswers = [];
                            currentQuestionIndex = 0;

                            yearSelection.style.display = 'none';
                            testSection.style.display = 'block';

                            updateScoreDisplay();
                            displayQuestion();
                        } else {
                            alert('No questions found');
                        }
                    }
                } else {
                    alert('Please ensure a level and subject is selected');
                }
            } else {
                alert('Please select year to proceed.');
            }
        });
    }


    /*startTest.addEventListener('click', () => {
        if (yearDropdown && yearDropdown.value.trim() !== "") {
            if (validateUsername()) {
                const level = localStorage.getItem('selectedLevel');
                const subject = localStorage.getItem('selectedSubject');
                const year = yearDropdown.value;

                console.log(`Selected Level: ${level}`)
                console.log(`Selected Subject: ${subject}`)
                console.log(`Selected Year: ${year}`)

                if (level && subject && year) {
                    questions = questionBank[level][subject][year];

                    if (questions && questions.length > 0) {
                        scoreBoard.remaining = questions.length;
                        userAnswers = [];
                        currentQuestionIndex = 0;

                        yearSelection.style.display = 'none';
                        testSection.style.display = 'block';

                        updateScoreDisplay();
                        displayQuestion();
                    } else {
                        alert('No questions found')
                    }
                } else {
                    alert ('Please ensure a level and subject is selected')
                }
            }
        } else{
            alert('Please select year to proceed.')
        }
    }); */


    // Update leaderboard section
    function updateLeaderboardSection() {
        const leaderboardTable = document.getElementById('leaderboard-results');
        leaderboardTable.innerHTML = '';
        leaderboardData.forEach((entry, index) => {
            const row = leaderboardTable.insertRow(index);
            const nameCell = row.insertCell(0);
            const levelCell = row.insertCell(1);
            const subjectCell = row.insertCell(2);
            const scoreCell = row.insertCell(3);

            nameCell.textContent = entry.name;
            levelCell.textContent = entry.level;
            subjectCell.textContent = entry.subject;
            scoreCell.textContent = entry.score + "%"; // 
        });
    }

    // Add score to leaderboard
    const savedLeaderboardData = localStorage.getItem('leaderboardData');
    if (savedLeaderboardData) {
        leaderboardData = JSON.parse(savedLeaderboardData);
    }
    // Save leaderboard data to local storage
    function addScoreToLeaderBoard(name, level, subject, score) {
        leaderboardData.push({
            name,
            level,
            subject,
            score
        });
        localStorage.setItem('leaderboardData', JSON.stringify(leaderboardData));
        updateLeaderboardSection();
    }

    // Update score display
    function updateScoreDisplay() {
        document.getElementById('correct-score').textContent = scoreBoard.correct;
        document.getElementById('wrong-score').textContent = scoreBoard.wrong;
        document.getElementById('unanswered-score').textContent = scoreBoard.unanswered;
        document.getElementById('remaining-questions').textContent = scoreBoard.remaining;
    }


    // Display questions
    function displayQuestion() {
        //Load current question from question bank
        const currentQuestion = questions[currentQuestionIndex];
        //call question text
        questionContainer.querySelector('#question').textContent = currentQuestion.question;

        const optionPrefixes = ['A', 'B', 'C', 'D'];
        const optionButtons = optionsContainer.querySelectorAll('.option-btn');
        optionButtons.forEach((btn, index) => {
            btn.innerHTML = `<strong><span class="option-prefix">${optionPrefixes[index]}. </span></strong> ${currentQuestion.options[index]}`;
            btn.onclick = () => {
                userAnswers[currentQuestionIndex] = currentQuestion.options[index];
                checkAnswer(currentQuestion.options[index]);
            };
        });

        resetTimer();
    }

    // Display inpage notifications
    function showNotification(type, message) {
        const notification = document.createElement('div');
        notification.classList.add('notification', type);
        notification.textContent = message;

        const notificationContainer = document.getElementById('notification-container');
        notificationContainer.appendChild(notification);

        setTimeout(() => {
            notification.style.display = 'block';
            notification.style.opacity = '1';
        }, 10);

        setTimeout(() => {
            hideNotification(notification);
        }, 2000);
    }

    // Hide inpage notifications
    function hideNotification(notification) {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.style.display = 'none';
            notification.remove();
        }, 500);
    }

    // Check answer
    function checkAnswer(selectedAnswer) {
        const currentQuestion = questions[currentQuestionIndex];
        if (selectedAnswer === currentQuestion.correctAnswer) {
            scoreBoard.correct++;
            showNotification('success', 'Correct!');
        } else if (selectedAnswer === null || selectedAnswer === 'Skipped') {
            scoreBoard.unanswered++;
            showNotification('warning', 'Do you want to come again Later?');
        } else {
            scoreBoard.wrong++;
            showNotification('error', 'Try Again Later!');
        }

        scoreBoard.remaining--;
        updateScoreDisplay();

        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            displayQuestion();
        } else {
            showNotification('info', 'Test completed!');
            clearInterval(timeInterval);
            displayReview();
        }
    }

    // Load next question
    /*nextQuestion.addEventListener('click', () => {
        userAnswers[currentQuestionIndex] = 'Skipped';
        checkAnswer('skipped');
        scoreBoard.unanswered++;
        scoreBoard.remaining--;
        updateScoreDisplay();
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            displayQuestion();
        } else {
            showNotification('info', 'Test completed!');
            clearInterval(timeInterval);
            displayReview();
        }
    }); */

    if (nextQuestion) {
        nextQuestion.addEventListener('click', () => {
            userAnswers[currentQuestionIndex] = 'Skipped';
            checkAnswer('skipped');
            scoreBoard.unanswered++;
            scoreBoard.remaining--;
            updateScoreDisplay();
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                displayQuestion();
            } else {
                showNotification('info', 'Test completed!');
                clearInterval(timeInterval);
                displayReview();
            }
        });
    }

    // Pause test
    /*pause.addEventListener('click', () => {
        isPaused = true;
        questionContainer.style.display = 'none';
        optionsContainer.style.display = 'none';
        showNotification('info', 'You paused test');
    });*/

    if (pause) {
        pause.addEventListener('click', () => {
            isPaused = true;
            questionContainer.style.display = 'none';
            optionsContainer.style.display = 'none';
            showNotification('info', 'You paused test');
        });
    }

    // Resume test
    /*resume.addEventListener('click', () => {
        isPaused = false;
        questionContainer.style.display = 'block';
        optionsContainer.style.display = 'flex';
        showNotification('info', 'You resumed test.');
    }); */

    if (resume) {
        resume.addEventListener('click', () => {
            isPaused = false;
            questionContainer.style.display = 'block';
            optionsContainer.style.display = 'flex';
            showNotification('info', 'You resumed test.');
        });
    }



    // Start timer
    function startTimer() {
        timeLeft = 60;
        timerBar.style.width = '100%';
        timeInterval = setInterval(() => {
            if (!isPaused) {
                timeLeft--;
                timerBar.style.width = `${(timeLeft / 60) * 100}%`;
                if (timeLeft <= 10) {
                    timerBar.style.backgroundColor = 'red';
                } else if (timeLeft <= 30) {
                    timerBar.style.backgroundColor = 'orange';
                } else {
                    timerBar.style.backgroundColor = 'green';
                }

                if (timeLeft <= 0) {
                    clearInterval(timeInterval);
                    showNotification('warning', 'Time is up!');
                    checkAnswer(null);
                }
            }
        }, 1000);
    }

    // Reset timer
    function resetTimer() {
        clearInterval(timeInterval);
        startTimer();
    }


    //Display review section
    function displayReview() {
        testSection.style.display = 'none';
        reviewSection.style.display = 'block';
        reviewSection.innerHTML = '';

        // Retrieve the selected subject and year from localStorage
        const selectedSubject = localStorage.getItem('selectedSubject');
        const selectedYear = localStorage.getItem('selectedYear');

        const headerHTML = `<h2>Review: ${selectedSubject} - Year ${selectedYear}</h2>`;
        reviewSection.innerHTML += headerHTML;

        const totalQuestions = questions.length;
        const correctAnswers = scoreBoard.correct;
        const score = ((correctAnswers / totalQuestions) * 100).toFixed(0); //present score as a percentage

        // Get selected level and subject from localStorage to display on leaderboard
        const name = localStorage.getItem('username');
        const level = localStorage.getItem('selectedLevel');
        const subject = localStorage.getItem('selectedSubject');

        addScoreToLeaderBoard(name, level, subject, score);

        questions.forEach((question, index) => {
            const userAnswer = userAnswers[index] || 'Not Answered';
            const correctAnswer = question.correctAnswer;

            const answerColor = userAnswer === 'Not Answered' || userAnswer === 'Skipped' ? 'orange' : userAnswer === correctAnswer ? 'green' : 'red';

            const questionHTML = `<div class="review-question">
            <p><strong>Q${index + 1}:</strong> ${question.question}</p>
            <p><strong>Your Answer:</strong> <span style="color: ${answerColor}">${userAnswer}</span></p>
            <p><strong>Correct Answer:</strong> <span style="color: green">${correctAnswer}</span></p>
            </div>`;

            reviewSection.innerHTML += questionHTML;
        });
        const buttonContainerHTML = `<div class="button-container"><button id="restart-test">Restart Test</button></div>`;
        reviewSection.innerHTML += buttonContainerHTML;

        /*reviewSection.innerHTML += '<button id="restart-test">Restart Test</button>';*/
        document.getElementById('restart-test').addEventListener('click', () => {
            location.reload();
        });
    }
});